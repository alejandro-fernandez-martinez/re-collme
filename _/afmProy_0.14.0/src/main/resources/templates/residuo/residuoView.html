<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:insert="/fragmentos.html::cabecera">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Productos CRUD</title>
</head>

<body>
  <nav th:replace="/fragmentos.html::menu"></nav>
  <nav th:replace="/fragmentos.html::menuAdmin"></nav>
  <h1>Listado de residuos</h1>

  <select id="select" onChange="changeCategory();">
    <option value="0">Todas</option>
    <option
      th:each="cat : ${listaCategorias}"
      th:value="${cat.idCat}"
      th:text="${cat.nomCat}"
      th:selected="${cat.nomCat} == ${categoriaSeleccionada} ? true : false"
    ></option>
  </select>
  <!-- <span th:text="${categoriaSeleccionada}">Cristales</span> -->

  <script>
    function changeCategory() {
      window.location.href =
        "/residuo/categoria/" + document.getElementById("select").value;
    }
  </script>


  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Categoría</th>
        <th>Fecha del registro</th>
        <th>Masa</th>
        <th>Volumen</th>
        <th sec:authorize="hasRole('NEGOCIANTE')">Calle</th>
        <th sec:authorize="hasRole('NEGOCIANTE')">Número</th>
        <th sec:authorize="hasRole('NEGOCIANTE')">Código Postal</th>
        <th sec:authorize="hasRole('NEGOCIANTE')">Localidad</th>
        <th>Provincia</th>
        <th sec:authorize="hasRole('NEGOCIANTE')">Solicitar reserva</th>

        <th sec:authorize="!isAuthenticated()">Añadir a pedido</th>
        <th sec:authorize="hasRole('NEGOCIANTE')">Añadir a pedido</th>
        <!-- (solo si autenticado) -->
        <th sec:authorize="isAuthenticated()">Editar producto</th>
        <th sec:authorize="isAuthenticated()">Borrar producto</th>
      </tr>
    </thead>

    <tbody>
      <tr th:each="r : ${listaResiduos}">
        <td th:text="${r.nomProd}">nomProd</td>
        <td th:text="${r.categoria.nomCat}">categoria</td>
        <td th:text="${r.fechaRegistroResiduo}">fecha</td>
        <td th:text="${r.masaResiduoKg}">masa</td>
        <td th:text="${r.dirCalleResiduo}">calle</td>
        <td th:text="${r.dirNumResiduo}">numero</td>
        <td th:text="${r.dirCodPostalResiduo}">codigoPostal</td>
        <td th:text="${r.dirLocalidadResiduo}">localidad</td>
        <td th:text="${r.dirProvinciaResiduo}">provincia</td>
        <!-- (solo si Negociante puede solicitar reserva) -->
        <td sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')"><a th:href="@{/residuo/solicitarReserva/{id}(id=${residuo.idResiduo})}">solicitarReserva</a></td>
        
        
        <!-- (solo si Negociante puede reservar) -->
        <td sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')"><a th:href="@{/residuo/reservar/{id}(id=${residuo.idProd})}">reservar</a></td>
        
        <!-- (solo si autenticado) --> <!-- le quise meter aqui esto pero no va: and #producto.vendedor.nomUser == authentication.name"-->
        <td sec:authorize="isAuthenticated()">
          <a th:href="@{/producto/edit/{id}(id=${producto.idProd})}">Editar</a>
        </td>
        <!-- (solo si autenticado) --> <!-- le quise meter aqui esto pero no va: and #producto.vendedor.nomUser == authentication.name"-->
        <td sec:authorize="isAuthenticated()">
          <a th:href="@{/producto/delete/{id}(id=${producto.idProd})}">Borrar</a>
        </td>
      </tr>
    </tbody>
  </table>
  <!-- (solo si autenticado) -->
  <a sec:authorize="isAuthenticated()" th:href="@{/producto/new}">Nuevo producto</a><br />
</body>

<footer th:insert="/fragmentos.html::footer">
</footer>  

</html>