<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:insert="/fragmentos.html::cabecera">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Residuos CRUD</title>
</head>

<body>
  <nav th:replace="/fragmentos.html::menu"></nav>
  <nav th:replace="/fragmentos.html::menuAdmin"></nav>
  <h1>Listado de residuos</h1>

  <select id="select" onChange="changeCategory();">
    <option value="0">Todas</option>
    <option
      th:each="cat : ${listaCategorias}"
      th:value="${cat.idCat}"
      th:text="${cat.nomCat}"
      th:selected="${cat.nomCat} == ${categoriaSeleccionada} ? true : false"
    ></option>
  </select>
  <!-- <span th:text="${categoriaSeleccionada}">Cristales</span> -->

  <script>
    function changeCategory() {
      window.location.href =
        "/residuo/categoria/" + document.getElementById("select").value;
    }
  </script>


  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Descripción</th>
        <th>Código LER</th>
        <th>Fecha de registro</th>
        <th>Masa (Kg)</th>
        <th>Volumen (m3)</th>
        <th sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')">Calle</th>
        <th sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')">Número</th>
        <th sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')">Código Postal</th>
        <th sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')">Localidad</th>
        <th>Provincia</th>
        <th sec:authorize="hasRole('ADMIN')" >Solicitado</th>
        <th sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')">Solicitante</th>
        <th sec:authorize="hasRole('ADMIN')">Reservado</th>
        <th sec:authorize="hasRole('ADMIN')">Gestor</th>
        <th sec:authorize="hasRole('ADMIN')">Recogido</th>
        <th sec:authorize="hasRole('ADMIN')">Bloqueado</th>
        <th> Categoria </th>
        <th sec:authorize="isAuthenticated()">Productor</th>

        <th sec:authorize="isAuthenticated()">Editar Residuo</th>
        <th sec:authorize="isAuthenticated()">Borrar Residuo</th>
        <th sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')">Solicitar Reserva</th>
        <th sec:authorize="isAuthenticated()">Aprobar Solicitude</th>
        <th sec:authorize="isAuthenticated()">Rexeitar Solicitude</th>
      </tr>
    </thead>

    <tbody>
      <tr th:each="r : ${listaResiduos}">
        <td th:text="${r.nomResiduo}">nomProd</td>
        <td th:text="${r.descripResiduo}">descripResiduo</td>
        <td th:text="${r.codLer}">codLer</td>
        <td th:text="${r.fechaRegistroResiduo}">fechaRegistroResiduo</td>
        <td th:text="${r.masaResiduoKg}">masa</td>
        <td th:text="${r.volumenResiduoM3}">volumen</td>
        <td sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')" th:text="${r.dirCalleResiduo}">dirCalleResiduo</td>
        <td sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')" th:text="${r.dirNumResiduo}">dirNumResiduo</td>
        <td sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')" th:text="${r.dirCodPostalResiduo}">dirCodPostalResiduo</td>
        <td sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')" th:text="${r.dirLocalidadResiduo}">dirLocalidadResiduo</td>
        <td th:text="${r.dirProvinciaResiduo}">dirProvinciaResiduo</td>
        <td sec:authorize="hasRole('ADMIN')" th:text="${r.solicitado}">solicitado</td>
        <td sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')"th:text="${r.solicitante}">solicitante</td>
        <td sec:authorize="hasRole('ADMIN')" th:text="${r.reservado}">reservado</td>
        <td sec:authorize="hasRole('ADMIN')" th:text="${r.gestor.nomUser}">gestor</td>
        <td sec:authorize="hasRole('ADMIN')" th:text="${r.recogido}">recogido</td>
        <td sec:authorize="hasRole('ADMIN')" th:text="${r.bloqueado}">bloqueado</td>
        <td th:text="${r.categoria.nomCat}">categoria</td>
        <td sec:authorize="isAuthenticated()" th:text="${r.productor.nomUser}">productor</td>
        
        <!-- (solo si autenticado) --> <!-- le quise meter aqui esto pero no va: and #producto.vendedor.nomUser == authentication.name"-->
        <td sec:authorize="isAuthenticated()">
          <a th:href="@{/producto/edit/{id}(id=${producto.idProd})}">Editar</a>
        </td>
        <!-- (solo si autenticado) --> <!-- le quise meter aqui esto pero no va: and #producto.vendedor.nomUser == authentication.name"-->
        <td sec:authorize="isAuthenticated()">
          <a th:href="@{/producto/delete/{id}(id=${producto.idProd})}">Borrar</a>
        </td>
        
        <!-- (solo si Negociante puede solicitar reserva) -->
        <td sec:authorize="hasAnyRole('NEGOCIANTE', 'ADMIN')"><a th:href="@{/residuo/solicitarReserva/{id}(id=${residuo.idResiduo})}">Solicitar Reserva</a></td>
        
        <!-- (solo si autenticado) --> <!-- le quise meter aqui esto pero no va: and #producto.vendedor.nomUser == authentication.name"-->
        <td sec:authorize="isAuthenticated()">
          <a th:href="@{/producto/edit/{id}(id=${producto.idProd})}">Aprobar Solicitude</a>
        </td>
        <!-- (solo si autenticado) --> <!-- le quise meter aqui esto pero no va: and #producto.vendedor.nomUser == authentication.name"-->
        <td sec:authorize="isAuthenticated()">
          <a th:href="@{/producto/edit/{id}(id=${producto.idProd})}">Rexeitar Solicitude</a>
        </td>
      </tr>
    </tbody>
  </table>
</body>

<footer th:insert="/fragmentos.html::footer">
</footer>  

</html>